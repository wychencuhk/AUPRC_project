<html>
<head>
<title>Weka.groovy</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000043; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #808080; font-style: italic;}
.s3 { color: #0000ff;}
.s4 { color: #008000; font-weight: bold;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Weka.groovy</font>
</center></td></tr></table>
<pre><span class="s0">public class </span>weka_AUPRC {

    <span class="s0">public static void </span>main(String[] args) {

    <span class="s2">// Set the probs, labels and classIndex(Just for the modified codes)</span>
        <span class="s0">int </span>classIndex = <span class="s3">1</span>;
        <span class="s0">double</span>[] probs = [<span class="s3">0.9</span>, <span class="s3">0.8</span>, <span class="s3">0.7</span>, <span class="s3">0.6</span>, <span class="s3">0.5</span>];
        <span class="s0">int</span>[] labels = [<span class="s3">1</span>, <span class="s3">0</span>, <span class="s3">1</span>, <span class="s3">0</span>, <span class="s3">0</span>];

        <span class="s0">double </span>totPos = <span class="s3">0</span>, totNeg = <span class="s3">0</span>;
        <span class="s2">// Get distribution of positive/negatives</span>
        <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s3">0</span>; i &lt; probs.length; i++) {
        <span class="s0">int </span>pred = labels[i];

        <span class="s0">if </span>(pred == classIndex) {
            totPos += <span class="s3">1</span>;
        } <span class="s0">else </span>{
            totNeg += <span class="s3">1</span>;
        }
        }

        <span class="s0">int</span>[] sorted = [<span class="s3">4</span>,<span class="s3">3</span>,<span class="s3">2</span>,<span class="s3">1</span>,<span class="s3">0</span>];


        <span class="s0">double </span>threshold = -<span class="s3">10</span>;
        <span class="s0">double </span>cumulativePos = <span class="s3">0</span>;
        <span class="s0">double </span>cumulativeNeg = <span class="s3">0</span>;

        ArrayList tps = [];
        ArrayList fps = [];
        ArrayList thresholds = []
        <span class="s0">double </span>fns = <span class="s3">0</span>;
        <span class="s0">double </span>tns = <span class="s3">0</span>;
        <span class="s0">double </span>tp = totPos
        <span class="s0">double </span>fp = totNeg
        <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s3">0</span>; i &lt; sorted.length; i++) {

            <span class="s0">if </span>((i == <span class="s3">0</span>) || (probs[sorted[i]] &gt; threshold)) {

                tps.add(tp - cumulativePos);
                fps.add(fp - cumulativeNeg);


                tp = tp - cumulativePos;
                fp = fp - cumulativeNeg;

                threshold = probs[sorted[i]];
                thresholds.add(threshold);
                cumulativePos = <span class="s3">0</span>;
                cumulativeNeg = <span class="s3">0</span>;

                <span class="s0">if </span>(i == sorted.length - <span class="s3">1</span>) {
                    <span class="s0">break</span>;
                }
            }

            <span class="s0">int </span>pred = labels[sorted[i]]

            <span class="s0">if </span>(pred == classIndex) {
                cumulativePos += <span class="s3">1</span>;
                } <span class="s0">else </span>{
                cumulativeNeg += <span class="s3">1</span>;
            }
            }


        fns = totPos.minus(tps[tps.size()-<span class="s3">1</span>]);
        tns = totNeg.minus(fps[fps.size()-<span class="s3">1</span>]);

        <span class="s0">if </span>(fns != totPos || tns != totNeg) {
            tps.add(<span class="s3">0</span>)
            fps.add(<span class="s3">0</span>);
            threshold = probs[sorted[sorted.length - <span class="s3">1</span>]] + <span class="s3">10e-6</span>;
            thresholds.add(threshold);
        }

        ArrayList tpr = []
        ArrayList fpr = []
        ArrayList precision = []
        ArrayList recall = []
        <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s3">0</span>; i &lt; tps.size(); i++) {
            <span class="s0">if </span>(<span class="s3">0 </span>== (totPos)) {
                tpr.add(Double.NaN);
            } <span class="s0">else </span>{
                tpr.add(tps[i] / totPos) ;
            }
            <span class="s0">if </span>(<span class="s3">0 </span>== (totNeg)) {
                fpr.add(Double.NaN);
            } <span class="s0">else </span>{
                fpr.add(fps[i] / (totNeg)) ;
            }
            <span class="s0">if </span>(<span class="s3">0 </span>== (tps[i] + fps[i])) {
                precision.add(Double.NaN) ;
            } <span class="s0">else </span>{
                precision.add(tps[i] / (tps[i] + fps[i])) ;
            }
            <span class="s0">if </span>(<span class="s3">0 </span>== (totPos)) {
                recall.add(Double.NaN);
            } <span class="s0">else </span>{
               recall.add(tps[i] / totPos) ;
            }
        }

        <span class="s2">//        Calculate the AUPRC</span>
        <span class="s0">int </span>n = tps.size()
        <span class="s0">final double</span>[] tpVals = tps
        <span class="s0">final double</span>[] fpVals = fps

        <span class="s0">double </span>area = <span class="s3">0.0</span>

        n = precision.size();

        <span class="s0">final double</span>[] pVals = precision;
        <span class="s0">final double</span>[] rVals = recall;

        area = <span class="s3">0</span>;
        <span class="s0">double </span>xlast = rVals[n - <span class="s3">1</span>];

        <span class="s2">// start from the first real p/r pair (not the artificial zero point)</span>
        <span class="s0">for </span>(<span class="s0">int </span>i = n - <span class="s3">2</span>; i &gt;= <span class="s3">0</span>; i--) {
            <span class="s0">double </span>recallDelta = rVals[i] - xlast;
            area += (pVals[i] * recallDelta);

            xlast = rVals[i];
        }
        System.out.println(<span class="s4">'AUPRC: '</span>+area)
    }

    }
</pre>
</body>
</html>